<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kids' Fun Zone</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Tone.js CDN for Music Maker -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-grey background */
        }
        /* Custom message box container */
        .message-box-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden; /* Hidden by default */
            opacity: 0;
            transition: visibility 0s, opacity 0.3s ease-in-out;
        }
        .message-box-container.show {
            visibility: visible;
            opacity: 1;
        }
        /* Styling for the message box content */
        .message-box-content {
            background-color: #ffffff;
            padding: 2.5rem; /* Increased padding */
            border-radius: 1.5rem; /* More rounded */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 95%; /* Allow wider for coloring game */
            width: 900px; /* Wider for game/app content */
            height: auto; /* Allow height to adjust to content */
            max-height: 90vh; /* Max height to prevent overflow on small screens */
            overflow-y: auto; /* Enable scrolling for longer content */
            border: 4px solid #6366f1; /* Purple border */
            display: flex; /* Use flex for content alignment */
            flex-direction: column;
            align-items: center;
        }
        .message-box-content h3 {
            color: #4f46e5; /* Deep purple for title */
            font-size: 1.875rem; /* Tailwind 'text-3xl' */
            font-weight: 700; /* Tailwind 'font-bold' */
            margin-bottom: 1rem;
        }
        .message-box-content p {
            color: #374151; /* Dark grey for text */
            font-size: 1.125rem; /* Tailwind 'text-lg' */
            margin-bottom: 1.5rem;
        }
        .message-box-content button {
            background-color: #6366f1; /* Purple button */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem; /* Rounded button */
            font-weight: 600; /* Semi-bold */
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
        }
        .message-box-content button:hover {
            background-color: #4f46e5; /* Darker purple on hover */
        }
        /* Styles for the dynamically loaded game/app content area */
        .game-content-area {
            width: 100%;
            margin-top: 1rem;
            text-align: left; /* Default alignment */
            padding: 0 1rem; /* Add some padding */
        }
        .game-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #a78bfa;
            border-radius: 0.75rem;
            text-align: center;
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }
        .game-message {
            margin-top: 1rem;
            font-size: 1.125rem;
            color: #374151;
            font-weight: 600;
        }
        /* Story list item styling */
        .story-list-item {
            background-color: #e0e7ff; /* Light blue for story items */
            padding: 1rem 1.5rem;
            margin-bottom: 0.75rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            font-weight: 600;
            color: #4f46e5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .story-list-item:hover {
            background-color: #c7d2fe;
            transform: translateY(-2px);
        }
        .story-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #374151;
            margin-bottom: 1.5rem;
        }
        .story-content h4 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4f46e5;
            margin-bottom: 1rem;
            text-align: center;
        }
        .story-image {
            max-width: 100%;
            height: auto;
            border-radius: 1rem;
            margin: 1.5rem auto; /* Center the image with margin */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: block; /* Ensures margin auto works for centering */
        }

        /* Animal Sounds App specific styles */
        .animal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            padding: 1rem;
            justify-items: center;
            max-height: 400px; /* Limit height for scrolling in main view */
            overflow-y: auto; /* Enable scrolling for many animals */
            width: 100%;
        }
        .animal-tile-small {
            background-color: #e2e8f0; /* Light grey for animal tiles */
            padding: 0.75rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 100%; /* Ensure responsiveness */
            max-width: 150px; /* Max width for individual tiles */
        }
        .animal-tile-small:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .animal-tile-small img {
            width: 80px;
            height: 80px;
            border-radius: 0.5rem;
            object-fit: cover;
            margin-bottom: 0.5rem;
            border: 2px solid #6366f1; /* Purple border for animal images */
        }
        .animal-tile-small span {
            font-weight: 600;
            color: #4f46e5;
            font-size: 0.9rem;
        }
        .animal-game-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
            width: 100%;
        }
        .animal-game-option {
            background-color: #d1d5db; /* Light gray for game options */
            padding: 1rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            font-weight: 600;
            color: #374151;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 1rem;
        }
        .animal-game-option:hover {
            background-color: #9ca3af;
            transform: translateY(-2px);
        }
        .animal-game-option.correct {
            background-color: #a7f3d0; /* Green for correct answer */
            border: 2px solid #059669;
        }
        .animal-game-option.incorrect {
            background-color: #fecaca; /* Red for incorrect answer */
            border: 2px solid #dc2626;
        }
        .animal-game-message {
            font-size: 1.1rem;
            font-weight: bold;
            margin-top: 1rem;
        }

        /* Coloring Fun specific styles */
        .coloring-page-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            padding: 1rem;
            justify-items: center;
            max-height: 450px;
            overflow-y: auto;
            width: 100%;
        }
        .coloring-thumbnail {
            background-color: #fff;
            padding: 0.75rem;
            border-radius: 1rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            border: 3px solid #cbd5e1; /* Light border */
        }
        .coloring-thumbnail:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            border-color: #a78bfa; /* Highlight on hover */
        }
        .coloring-thumbnail img {
            width: 140px;
            height: 140px;
            object-fit: contain; /* Ensure image fits without cropping */
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            background-color: #f8fafc; /* Light background for images */
        }
        .coloring-thumbnail span {
            font-weight: 600;
            color: #4f46e5;
            font-size: 1rem;
        }
        .coloring-canvas-main-area {
            display: flex;
            flex-direction: column; /* Default to column for small screens */
            gap: 2rem;
            width: 100%;
            align-items: flex-start; /* Align content to the start */
            text-align: left; /* Default text alignment */
        }

        @media (min-width: 768px) { /* On medium screens and up, use row layout */
            .coloring-canvas-main-area {
                flex-direction: row;
                justify-content: space-around;
            }
        }

        .coloring-reference-section, .coloring-interactive-section {
            flex: 1; /* Allow sections to grow */
            min-width: 280px; /* Minimum width for each section */
            max-width: 45%; /* Max width to ensure side-by-side on larger screens */
            display: flex;
            flex-direction: column;
            align-items: center; /* Center items within sections */
            text-align: center; /* Center text within sections */
        }

        .coloring-image-display {
            max-width: 100%;
            height: auto;
            border-radius: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 1rem;
            border: 4px solid #a78bfa; /* Light purple border for reference image */
        }
        .color-palette {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 1rem;
            margin-bottom: 1.5rem;
        }
        .color-swatch {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid #ccc;
            transition: transform 0.1s ease-in-out, border-color 0.1s ease-in-out;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .color-swatch:hover {
            transform: scale(1.1);
            border-color: #6366f1;
        }
        .color-swatch.selected {
            border-color: #4f46e5;
            box-shadow: 0 0 0 4px #c7d2fe; /* Outer glow for selected */
        }

        /* Pixel Art Grid specific styles */
        .pixel-art-grid-container {
            display: grid;
            /* Explicitly setting all borders for consistent rendering */
            border: 5px solid #4f46e5; /* Increased thickness for prominence */
            box-sizing: border-box; /* Ensure padding and border are included in element's total width and height */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            max-width: 400px; /* Max width for the pixel grid */
            margin: 0 auto; /* Center the grid */
            background-color: #ffffff; /* White background for empty pixels */
        }
        .pixel-box {
            width: var(--pixel-size); /* Defined by JS for square aspect */
            height: var(--pixel-size); /* Defined by JS for square aspect */
            background-color: #ffffff; /* Default empty pixel color */
            border: 1px solid #e2e8f0; /* Light grey border for pixel separation */
            cursor: pointer;
            transition: background-color 0.05s ease-in-out; /* Smooth color change */
        }
        .pixel-box:hover {
            transform: scale(1.05);
            z-index: 1; /* Bring hovered pixel slightly forward */
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }

        /* Responsive adjustments for coloring game */
        @media (max-width: 767px) {
            .coloring-reference-section, .coloring-interactive-section {
                max-width: 100%; /* Full width on small screens */
            }
            .coloring-image-display {
                max-width: 250px; /* Limit size of reference image on small screens */
            }
            .pixel-art-grid-container {
                max-width: 300px; /* Adjust max width for grid on smaller screens */
            }
        }

        /* Music Maker specific styles */
        .piano-keyboard {
            display: flex;
            justify-content: center;
            margin-top: 2rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap; /* Allow keys to wrap on smaller screens */
            gap: 0.5rem; /* Space between keys */
            background-color: #333; /* Dark background for piano base */
            padding: 0.5rem;
            border-radius: 0.75rem;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        .piano-key {
            background-color: #fef08a; /* Light yellow */
            border: 2px solid #facc15; /* Yellow border */
            border-radius: 0.5rem;
            padding: 1rem 0.75rem;
            min-width: 50px; /* Ensure keys have a minimum width */
            text-align: center;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.1s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            color: #78350f; /* Dark brown text */
        }
        .piano-key:active, .piano-key.active-key { /* Combined active states */
            background-color: #fcd34d; /* Darker yellow on press */
            transform: translateY(2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .melody-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .melody-button {
            background-color: #a78bfa; /* Light purple */
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .melody-button:hover {
            background-color: #8b5cf6; /* Darker purple on hover */
            transform: translateY(-2px);
        }
        .melody-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .music-controls {
            margin-top: 2rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        .current-note-display {
            font-size: 2.5rem; /* Large font for current note */
            font-weight: 800; /* Extra bold */
            color: #4f46e5; /* Deep purple */
            margin-bottom: 1rem;
            min-height: 3rem; /* Ensure space even when empty */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Shape Sorter specific styles */
        .shape-sorter-game {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            padding: 1rem;
        }
        .shape-drag-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1.5rem;
            padding: 1.5rem;
            border: 2px dashed #a78bfa;
            border-radius: 1rem;
            background-color: #eef2ff; /* Light purple background */
            min-height: 150px;
            width: 100%;
            margin-bottom: 2rem;
        }
        .draggable-shape {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem; /* Emoji size */
            cursor: grab;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            border-radius: 0.75rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: #ffffff; /* White background for shapes */
            border: 2px solid #6366f1; /* Purple border */
        }
        .draggable-shape:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .draggable-shape.dragging {
            opacity: 0.5;
            border: 2px dashed #4f46e5;
        }

        .shape-drop-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1.5rem;
            width: 100%;
        }
        .drop-bin {
            width: 120px;
            height: 120px;
            border: 4px dashed #60a5fa; /* Blue dashed border */
            border-radius: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #e0f2fe; /* Light blue background */
            color: #2563eb; /* Darker blue text */
            font-weight: bold;
            font-size: 0.9rem;
            text-align: center;
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }
        .drop-bin.drag-over {
            background-color: #bfdbfe; /* Lighter blue on drag over */
            border-color: #1d4ed8; /* Darker blue border */
        }
        .drop-bin.correct-drop {
            background-color: #a7f3d0; /* Green on correct drop */
            border-color: #059669;
        }
        .drop-bin.incorrect-drop {
            background-color: #fecaca; /* Red on incorrect drop */
            border-color: #dc2626;
        }
        .drop-bin span {
            margin-top: 0.5rem;
        }
        .drop-bin svg {
            width: 50px;
            height: 50px;
            fill: currentColor; /* Inherit color from parent */
        }
        .score-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4f46e5;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }
        .game-feedback {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1rem;
            min-height: 1.5rem; /* Ensure space for messages */
        }

        /* Memory Match specific styles */
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 columns for memory cards */
            gap: 1rem;
            padding: 1rem;
            justify-items: center;
            width: 100%;
            max-width: 500px; /* Max width for the grid */
            margin: 0 auto;
        }
        .memory-card {
            width: 100px; /* Fixed width for cards */
            height: 100px; /* Fixed height for cards */
            background-color: #a78bfa; /* Card back color */
            border-radius: 0.75rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem; /* Emoji size */
            color: transparent; /* Hide emoji initially */
            transition: background-color 0.3s ease, transform 0.3s ease, color 0.3s ease;
            transform-style: preserve-3d; /* For flip animation */
            position: relative;
        }
        .memory-card.flipped {
            background-color: #ffffff; /* Card face color */
            color: #4f46e5; /* Emoji color when flipped */
            transform: rotateY(180deg);
        }
        .memory-card.matched {
            background-color: #d1fae5; /* Light green for matched */
            pointer-events: none; /* Disable clicks on matched cards */
            /* MODIFIED: Removed opacity: 0.7; to make tick mark more visible */
        }
        .memory-card-inner {
            width: 100%;
            height: 100%;
            position: absolute;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .memory-card-front {
            transform: rotateY(180deg); /* Front is initially rotated */
            color: #4f46e5; /* Emoji color */
            position: relative; /* Needed for absolute positioning of indicator */
        }
        .memory-card-back {
            background-color: #a78bfa; /* Card back color */
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white; /* Question mark color */
            z-index: 2;
        }
        .memory-card-matched-indicator {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 1.5rem;
            opacity: 0; /* Hidden by default */
            transition: opacity 0.3s ease-in-out;
            color: #16a34a; /* Green checkmark */
        }
        .memory-card.matched .memory-card-matched-indicator {
            opacity: 1; /* Show when matched */
        }

        /* Number Explorer specific styles */
        .number-explorer-game {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            padding: 1rem;
        }
        .number-display-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            padding: 1.5rem;
            border: 2px solid #60a5fa;
            border-radius: 1rem;
            background-color: #e0f2fe;
            min-height: 150px;
            width: 100%;
            max-width: 600px;
            margin-bottom: 2rem;
        }
        /* NEW: Styles for banana and operator SVGs */
        .number-item-banana-svg {
            width: 50px;
            height: 50px;
            fill: #facc15; /* Yellow */
            stroke: #eab308; /* Darker yellow border */
            stroke-width: 2;
        }
        .operator-svg {
            width: 40px;
            height: 40px;
            fill: #4f46e5; /* Purple */
            margin: 0 10px;
        }
        .number-input-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 400px;
        }
        .number-problem-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4f46e5;
            margin-bottom: 1.5rem;
            min-height: 3rem; /* Ensure space */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .number-game-options {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .number-game-option-btn {
            background-color: #6366f1;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
        }
        .number-game-option-btn:hover {
            background-color: #4f46e5;
        }

        /* NEW: Theme specific styles */
        .theme-rainbow {
            background-color: #e0f2fe; /* Light blue */
        }
        .theme-rainbow .main-header {
            background-image: linear-gradient(to right, #ef4444, #f97316, #eab308, #22c55e, #3b82f6, #6366f1, #9333ea); /* Rainbow gradient */
        }
        .theme-unicorn {
            background-color: #fce7f3; /* Light pink */
        }
        .theme-unicorn .main-header {
            background-image: linear-gradient(to right, #fbcfe8, #f0abfc, #d8b4fe); /* Pastel pink/purple */
        }
        .theme-chocolate {
            background-color: #fef3c7; /* Creamy yellow */
        }
        .theme-chocolate .main-header {
            background-image: linear-gradient(to right, #7c2d12, #9a3412, #b45309); /* Brown/orange */
        }
        .theme-carracing {
            background-color: #e2e8f0; /* Light grey */
        }
        .theme-carracing .main-header {
            background-image: linear-gradient(to right, #1f2937, #374151, #4b5563); /* Dark grey/black */
        }

        /* Ensure header and footer use a class for theme application */
        .main-header {
            background-image: linear-gradient(to right, #8b5cf6, #6366f1); /* Default gradient */
        }
        .main-footer {
            background-color: #1f2937; /* Default dark footer */
        }

        /* Styles for theme selection grid */
        .theme-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            padding: 1rem;
            justify-items: center;
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
        }
        .theme-option-card {
            background-color: #fff;
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            border: 3px solid #cbd5e1;
        }
        .theme-option-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            border-color: #6366f1;
        }
        .theme-option-card .theme-preview-box {
            width: 80px;
            height: 80px;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            border: 2px solid #ccc;
        }
        .theme-option-card span {
            font-weight: 600;
            color: #4f46e5;
            font-size: 1rem;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- Header Section -->
    <!-- MODIFIED: Added 'main-header' class for theme styling -->
    <header class="main-header bg-gradient-to-r from-purple-600 to-indigo-700 text-white p-6 shadow-lg rounded-b-2xl">
        <div class="container mx-auto text-center">
            <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight">
                <span class="block">ðŸš€ DNZ Space ðŸŽ®</span>
            </h1>
            <p class="mt-2 text-lg md:text-xl opacity-90">Discover exciting games and apps!</p>
        </div>
    </header>

    <!-- Main Content - Game/App Tiles -->
    <main class="flex-grow container mx-auto px-4 py-8 md:py-12">
        <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 md:gap-8 justify-center">
            <!-- Tile 1: Story Time Adventures - NOW WITH INTERACTIVE STORIES -->
            <div class="game-tile bg-white p-6 rounded-2xl shadow-xl hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-300 cursor-pointer border-b-4 border-purple-500"
                 data-title="Story Time Adventures" data-description="Embark on magical story journeys!" data-game-id="story-time-adventures">
                <div class="flex flex-col items-center justify-center h-full">
                    <img src="../resources/images/story_tile.png" alt="Story Book Icon" class="mb-4 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 text-center mb-2">Story Time Adventures</h2>
                    <p class="text-gray-600 text-center text-sm">Interactive stories for young readers.</p>
                </div>
            </div>

            <!-- Tile 2: Guess the Number Game -->
            <!--
                HOW TO ADD A NEW GAME/APP:
                1.  Add a new 'div' with class 'game-tile'.
                2.  Set 'data-title' to the game/app's display name.
                3.  Set 'data-description' for a brief overview.
                4.  IMPORTANT: Add 'data-game-id' with a unique ID for your game/app (e.g., 'your-game-id').
                    This ID will be used in JavaScript to identify and load your content.
                5.  Update the 'img' src and alt attributes for your game/app's icon.
                6.  In the JavaScript section, create a new function `initYourGameId()` (e.g., `initYourNewGameId()`).
                    This function should:
                    -   Clear the #gameContentArea.
                    -   Inject your game/app's HTML structure into #gameContentArea.
                    -   Implement your game/app's logic and event listeners.
                7.  Add a case for your 'data-game-id' in the `loadGame` function's switch statement
                    to call your `initYourGameId()` function.
            -->
            <div class="game-tile bg-white p-6 rounded-2xl shadow-xl hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-300 cursor-pointer border-b-4 border-indigo-500"
                 data-title="Guess the Number" data-description="Can you guess the secret number?" data-game-id="guess-the-number">
                <div class="flex flex-col items-center justify-center h-full">
                    <img src="../resources/images/guess_number.png" alt="Question Mark Numbers Icon" class="mb-4 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 text-center mb-2">Guess the Number</h2>
                    <p class="text-gray-600 text-center text-sm">Guess the secret number from 1 to 100!</p>
                </div>
            </div>

            <!-- Tile 3: Coloring Fun - NOW WITH INTERACTIVE APP -->
            <div class="game-tile bg-white p-6 rounded-2xl shadow-xl hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-300 cursor-pointer border-b-4 border-green-500"
                 data-title="Coloring Fun" data-description="Unleash your creativity with colors!" data-game-id="coloring-fun">
                <div class="flex flex-col items-center justify-center h-full">
                    <img src="../resources/images/colour.png" alt="Paint Palette Icon" class="mb-4 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 text-center mb-2">Coloring Fun</h2>
                    <p class="text-gray-600 text-center text-sm">Digital coloring book with many options.</p>
                </div>
            </div>

            <!-- Tile 4: Animal Sounds - NOW WITH INTERACTIVE APP -->
            <div class="game-tile bg-white p-6 rounded-2xl shadow-xl hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-300 cursor-pointer border-b-4 border-red-500"
                 data-title="Animal Sounds" data-description="Learn about animals and their sounds!" data-game-id="animal-sounds">
                <div class="flex flex-col items-center justify-center h-full">
                    <img src="../resources/images/lion.png" alt="Lion Icon" class="mb-4 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 text-center mb-2">Animal Sounds</h2>
                    <p class="text-gray-600 text-center text-sm">Interactive app for animal recognition.</p>
                </div>
            </div>

            <!-- Tile 5: Number Explorer - NEW APP -->
            <div class="game-tile bg-white p-6 rounded-2xl shadow-xl hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-300 cursor-pointer border-b-4 border-blue-500"
                 data-title="Number Explorer" data-description="Explore numbers and counting!" data-game-id="number-explorer">
                <div class="flex flex-col items-center justify-center h-full">
                    <img src="../resources/images/numbers.png" alt="Numbers Icon" class="mb-4 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 text-center mb-2">Number Explorer</h2>
                    <p class="text-gray-600 text-center text-sm">Fun activities for learning numbers.</p>
                </div>
            </div>

            <!-- Tile 6: Music Maker - NOW WITH INTERACTIVE APP -->
            <div class="game-tile bg-white p-6 rounded-2xl shadow-xl hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-300 cursor-pointer border-b-4 border-yellow-500"
                 data-title="Music Maker" data-description="Create your own tunes and melodies!" data-game-id="music-maker">
                <div class="flex flex-col items-center justify-center h-full">
                    <img src="../resources/images/music.png" alt="Music Notes Icon" class="mb-4 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 text-center mb-2">Music Maker</h2>
                    <p class="text-gray-600 text-center text-sm">Simple music creation for kids.</p>
                </div>
            </div>

            <!-- Tile 7: Shape Sorter - NEW APP -->
            <div class="game-tile bg-white p-6 rounded-2xl shadow-xl hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-300 cursor-pointer border-b-4 border-pink-500"
                 data-title="Shape Sorter" data-description="Match shapes and learn geometry!" data-game-id="shape-sorter">
                <div class="flex flex-col items-center justify-center h-full">
                    <img src="../resources/images/shapes.png" alt="Triangle Icon" class="mb-4 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 text-center mb-2">Shape Sorter</h2>
                    <p class="text-gray-600 text-center text-sm">Identify and sort different shapes.</p>
                </div>
            </div>

            <!-- Tile 8: Memory Match - NEW APP -->
            <div class="game-tile bg-white p-6 rounded-2xl shadow-xl hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-300 cursor-pointer border-b-4 border-teal-500"
                 data-title="Memory Match" data-description="Test your memory with fun cards!" data-game-id="memory-match">
                <div class="flex flex-col items-center justify-center h-full">
                    <img src="../resources/images/matching.png" alt="Brain Icon" class="mb-4 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 text-center mb-2">Memory Match</h2>
                    <p class="text-gray-600 text-center text-sm">Find matching pairs in this classic game.</p>
                </div>
            </div>

            <!-- NEW: Theme Selector Tile -->
            <div class="game-tile bg-white p-6 rounded-2xl shadow-xl hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-300 cursor-pointer border-b-4 border-gray-400"
                 data-title="Theme Selector" data-description="Change the look of the Fun Zone!" data-game-id="theme-selector">
                <div class="flex flex-col items-center justify-center h-full">
                    <img src="../resources/images/theme.png" alt="Theme Icon" class="mb-4 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 text-center mb-2">Theme Selector</h2>
                    <p class="text-gray-600 text-center text-sm">Personalize your Fun Zone experience.</p>
                </div>
            </div>

        </section>
    </main>

    <!-- Footer Section -->
    <!-- MODIFIED: Added 'main-footer' class for theme styling -->
    <footer class="main-footer bg-gray-800 text-white p-4 text-center rounded-t-2xl mt-8">
        <p>&copy; 2025 Kids' Fun Zone. All rights reserved.</p>
    </footer>

    <!-- Message Box Container -->
    <div id="messageBoxContainer" class="message-box-container">
        <div class="message-box-content">
            <h3 id="messageBoxTitle"></h3>
            <!-- Area where specific game UI will be loaded -->
            <div id="gameContentArea" class="game-content-area">
                <!-- Game UI will be dynamically injected here -->
            </div>
            <button id="closeMessageBox" class="mt-6">Close</button>
        </div>
    </div>

    <script>
        // Get all game tiles
        const gameTiles = document.querySelectorAll('.game-tile');
        const messageBoxContainer = document.getElementById('messageBoxContainer');
        const messageBoxTitle = document.getElementById('messageBoxTitle');
        const gameContentArea = document.getElementById('gameContentArea'); // New: Div for game content
        const closeMessageBoxButton = document.getElementById('closeMessageBox');

        /**
         * Clears the game content area and resets the message box title.
         */
        function clearMessageBoxContent() {
            messageBoxTitle.textContent = '';
            gameContentArea.innerHTML = ''; // Clear previous game content
        }

        /**
         * Shows the custom message box and loads the specified game or placeholder content.
         * @param {string} title - The title to display in the message box.
         * @param {string} description - The description or initial message.
         * @param {string} [gameId] - Optional; The ID of the game to load.
         */
        function showMessageBox(title, description, gameId) {
            clearMessageBoxContent(); // Clear any previous content

            messageBoxTitle.textContent = title;

            if (gameId) {
                // If a gameId is provided, load the specific game
                loadGame(gameId);
            } else {
                // Otherwise, show the placeholder text
                gameContentArea.innerHTML = `<p class="text-gray-600">${description}</p>`;
            }

            messageBoxContainer.classList.add('show');
            console.log(`Simulating navigation to: ${title} - ${description}`);
        }

        /**
         * Hides the custom message box.
         */
        function hideMessageBox() {
            messageBoxContainer.classList.remove('show');
            clearMessageBoxContent(); // Clean up content when closing
            // Stop any ongoing music sequences when closing the music maker
            if (window.Tone && window.Tone.Transport) {
                Tone.Transport.stop();
                Tone.Transport.cancel();
            }
        }

        /**
         * Loads the UI and logic for a specific game/app based on its ID.
         * This function acts as a router for different content.
         * @param {string} gameId - The unique ID of the game/app to load.
         */
        function loadGame(gameId) {
            gameContentArea.innerHTML = ''; // Ensure clean slate for the content
            switch (gameId) {
                case 'guess-the-number':
                    initGuessTheNumberGame();
                    break;
                case 'story-time-adventures':
                    initStoryTimeAdventures();
                    break;
                case 'animal-sounds':
                    initAnimalSoundsApp();
                    break;
                case 'coloring-fun':
                    initColoringFun();
                    break;
                case 'music-maker':
                    initMusicMakerApp();
                    break;
                case 'shape-sorter':
                    initShapeSorterGame();
                    break;
                case 'memory-match':
                    initMemoryMatchGame();
                    break;
                case 'number-explorer':
                    initNumberExplorerGame();
                    break;
                case 'theme-selector': // NEW: Case for Theme Selector
                    initThemeSelector();
                    break;
                default:
                    gameContentArea.innerHTML = `<p class="text-red-500">Content with ID "${gameId}" not found. (Placeholder)</p>`;
                    break;
            }
        }

        /* --- Game Implementations --- */

        /**
         * Initializes and sets up the "Guess the Number" game.
         */
        function initGuessTheNumberGame() {
            let secretNumber = Math.floor(Math.random() * 100) + 1;
            let attempts = 0;
            const maxAttempts = 10; // Set a limit for attempts

            // Inject game HTML
            gameContentArea.innerHTML = `
                <p class="text-gray-700 text-lg mb-4">I'm thinking of a number between 1 and 100. Can you guess it?</p>
                <input type="number" id="guessInput" class="game-input" placeholder="Enter your guess (1-100)">
                <button id="checkGuessButton" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-xl shadow-md transition-colors duration-200">Guess!</button>
                <p id="guessMessage" class="game-message mt-4"></p>
                <button id="resetGameButton" class="bg-gray-400 hover:bg-gray-500 text-white font-semibold py-2 px-4 rounded-xl shadow-md transition-colors duration-200 mt-4 hidden">Play Again</button>
            `;

            // Get game elements
            const guessInput = document.getElementById('guessInput');
            const checkGuessButton = document.getElementById('checkGuessButton');
            const guessMessage = document.getElementById('guessMessage');
            const resetGameButton = document.getElementById('resetGameButton');

            /**
             * Checks the user's guess against the secret number.
             */
            function checkGuess() {
                const userGuess = parseInt(guessInput.value);

                if (isNaN(userGuess) || userGuess < 1 || userGuess > 100) {
                    guessMessage.textContent = 'Please enter a valid number between 1 and 100.';
                    guessMessage.style.color = '#dc2626'; // Red for error
                    return;
                }

                attempts++;

                if (userGuess === secretNumber) {
                    guessMessage.textContent = `ðŸŽ‰ Congratulations! You guessed the number ${secretNumber} in ${attempts} attempts!`;
                    guessMessage.style.color = '#16a34a'; // Green for success
                    guessInput.disabled = true;
                    checkGuessButton.disabled = true;
                    resetGameButton.classList.remove('hidden');
                } else if (userGuess < secretNumber) {
                    guessMessage.textContent = `Too low! Try again. Attempts: ${attempts}/${maxAttempts}`;
                    guessMessage.style.color = '#f59e0b'; // Yellow for hint
                } else {
                    guessMessage.textContent = `Too high! Try again. Attempts: ${attempts}/${maxAttempts}`;
                    guessMessage.style.color = '#f59e0b'; // Yellow for hint
                }

                if (attempts >= maxAttempts && userGuess !== secretNumber) {
                    guessMessage.textContent = `Game Over! You ran out of attempts. The number was ${secretNumber}.`;
                    guessMessage.style.color = '#dc2626'; // Red for game over
                    guessInput.disabled = true;
                    checkGuessButton.disabled = true;
                    resetGameButton.classList.remove('hidden');
                }

                guessInput.value = ''; // Clear input field
            }

            /**
             * Resets the "Guess the Number" game.
             */
            function resetGame() {
                secretNumber = Math.floor(Math.random() * 100) + 1;
                attempts = 0;
                guessInput.value = '';
                guessMessage.textContent = '';
                guessInput.disabled = false;
                checkGuessButton.disabled = false;
                resetGameButton.classList.add('hidden');
            }

            // Add event listeners for the game
            checkGuessButton.addEventListener('click', checkGuess);
            guessInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    checkGuess();
                }
            });
            resetGameButton.addEventListener('click', resetGame);
        }

        /* --- Story Time Adventures Implementation --- */

        /**
         * Dummy story data. In a real app, this might come from an API or external files.
         * Each story now includes an `imageUrl` and `imageAlt` for illustrative purposes.
         *
         * To generate your own AI images for these stories (or any other content):
         * You can use free online AI image generators. Some popular options include:
         * -   **Craiyon (formerly DALL-E mini):** craiyon.com (simple, free, good for quick concepts)
         * -   **Leonardo.Ai (free tier available):** leonardo.ai (more features, higher quality)
         * -   **Stable Diffusion Online (various sites host it):** search for "Stable Diffusion online free"
         * -   **Bing Image Creator (powered by DALL-E):** bing.com/images/create (requires Microsoft account)
         *
         * When generating, use prompts that describe the scene or character from the story, e.g.:
         * -   "A cute little bear cub trying to roar, in a cozy forest, cartoon style, vibrant colors"
         * -   "Two children, a girl and a boy, inside a magical treehouse filled with crystals, looking at a map, whimsical art"
         * -   "A small robot climbing a giant clock tower in a futuristic city, cartoon, friendly art style"
         *
         * Once you have the images, upload them to a public image hosting service (like Imgur for testing, or your own hosting)
         * and replace the `placehold.co` URLs below with your actual image URLs.
         */
        const stories = {
            "the-little-bear": {
                title: "The Little Bear Who Lost His Roar",
                content: `
                    Once upon a time, in a cozy forest, lived a little bear named Barnaby.
                    Barnaby loved to play, but he had a secret: he couldn't roar! All the other bears
                    had mighty roars that shook the leaves, but Barnaby's was just a tiny squeak.
                    <br><br>
                    One sunny morning, Barnaby decided he would find his roar. He asked the wise old owl,
                    "How can I find my roar?" The owl hooted softly, "Your roar isn't lost, little bear.
                    It's inside you, waiting to be brave!"
                    <br><br>
                    Barnaby wasn't sure what that meant, but he decided to try being brave.
                    He saw a tiny squirrel struggling to reach a nut high on a branch.
                    Barnaby carefully nudged the branch, and the nut fell. The squirrel chattered happily.
                    <br><br>
                    Next, he saw a baby bird fall from its nest. Barnaby gently picked it up
                    and placed it back. The mother bird sang a sweet thank you.
                    <br><br>
                    Later, a big, grumpy badger blocked the path. Barnaby took a deep breath,
                    and though scared, he puffed out his chest and said, "Excuse me, Mr. Badger,
                    may I please pass?" The badger, surprised by Barnaby's politeness and bravery,
                    grumbled and moved aside.
                    <br><br>
                    As Barnaby walked home, he felt a warmth in his chest. He saw his reflection
                    in a pond and decided to try again. He took a huge breath, and this time,
                    a magnificent, rumbling ROAR burst forth! It wasn't loud, but it was strong and true.
                    Barnaby smiled. He had found his roar by being kind and brave.
                `,
                imageUrl: "../resources/images/bear.png",
                imageAlt: "A cute little bear cub trying to roar in a forest"
            },
            "the-magical-treehouse": {
                title: "The Magical Treehouse Adventure",
                content: `
                    Lily and Tom discovered a treehouse unlike any other. It glowed with a soft,
                    rainbow light and hummed with a gentle tune. Inside, instead of dusty boards,
                    were sparkling crystals and a map to fantastical lands.
                    <br><br>
                    "Where should we go first?" whispered Lily, eyes wide with wonder.
                    "The Candy Cloud Kingdom!" shouted Tom, pointing to a swirl of pink on the map.
                    <br><br>
                    They touched the spot, and with a whoosh, the treehouse spun. When it stopped,
                    they were floating amidst clouds made of cotton candy and rivers of fizzy lemonade!
                    They laughed and ate until their tummies were full.
                    <br><br>
                    Their next adventure took them to the Whispering Woods, where trees told ancient
                    tales, and then to the Sparkle Stone Caves, filled with gems that twinkled like stars.
                    Every journey from the magical treehouse was a new, delightful surprise.
                    <br><br>
                    They knew that no matter where they went, their greatest adventure was always
                    the joy of discovering new places together. And the magical treehouse was always
                    ready for their next big dream.
                `,
                imageUrl: "../resources/images/story_forest.png",
                imageAlt: "Children in a glowing magical treehouse"
            },
            "the-brave-little-robot": {
                title: "The Brave Little Robot",
                content: `
                    In a world of gleaming gears and whirring circuits, lived a small robot named Bolt.
                    Bolt was not very big, nor very strong, but he had the biggest heart of all.
                    His job was to fix tiny, broken things in the city.
                    <br><br>
                    One day, the city's giant clock tower stopped ticking. Everyone was worried.
                    "It's too high!" cried the tall robots. "It's too complicated!" whirred the smart robots.
                    <br><br>
                    But Bolt, seeing the sadness in the citizens' eyes, decided to try.
                    He carefully climbed the gears, one tiny cog at a time, until he reached the very top.
                    With his small, precise tools, he found the loose spring and fixed it.
                    <br><br>
                    *Tick-tock!* The giant clock began to chime again! The city cheered for Bolt,
                    the brave little robot who proved that even the smallest among us can do the biggest things.
                `,
                imageUrl: "../resources/images/story_robot.png",
                imageAlt: "A small robot fixing a giant clock tower"
            }
        };

        /**
         * Initializes and sets up the "Story Time Adventures" interface.
         */
        function initStoryTimeAdventures() {
            // Display a list of available stories
            let storyListHtml = '<p class="text-gray-700 text-lg mb-4">Choose a story to read:</p>';
            storyListHtml += '<div class="w-full flex flex-col items-center">';
            for (const storyId in stories) {
                storyListHtml += `
                    <div class="story-list-item w-full md:w-3/4 lg:w-2/3" data-story-id="${storyId}">
                        <span>${stories[storyId].title}</span>
                        <span>âž¡ï¸</span>
                    </div>
                `;
            }
            storyListHtml += '</div>';

            gameContentArea.innerHTML = storyListHtml;
            messageBoxTitle.textContent = "Story Time Adventures";

            // Add event listeners to each story item
            document.querySelectorAll('.story-list-item').forEach(item => {
                item.addEventListener('click', (event) => {
                    const storyId = event.currentTarget.dataset.storyId;
                    displayStory(storyId);
                });
            });
        }

        /**
         * Displays the content of a selected story, now including an image.
         * @param {string} storyId - The ID of the story to display.
         */
        function displayStory(storyId) {
            const story = stories[storyId];
            if (!story) {
                gameContentArea.innerHTML = `<p class="text-red-500">Story not found!</p>`;
                return;
            }

            gameContentArea.innerHTML = `
                <h4 class="mb-4">${story.title}</h4>
                <img src="${story.imageUrl}" alt="${story.imageAlt}" class="story-image">
                <div class="story-content text-justify">${story.content}</div>
                <button id="backToStoriesButton" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-xl shadow-md transition-colors duration-200 mt-4">Back to Stories</button>
            `;
            messageBoxTitle.textContent = story.title; // Update title for the specific story

            document.getElementById('backToStoriesButton').addEventListener('click', initStoryTimeAdventures);
        }

        /* --- Animal Sounds App Implementation --- */

        /**
         * Data for animals including their names, placeholder images, and simulated sounds.
         * In a real application, `soundFile` would be an actual audio file URL.
         * For sound, you could use a library like Tone.js to synthesize sounds, or if you have
         * publicly hosted audio files, you can link them.
         * Example for Tone.js (not included in this demo for simplicity, but for reference):
         * const synth = new Tone.Synth().toDestination();
         * synth.triggerAttackRelease("C4", "8n"); // Plays a C4 note for an eighth note
         */
        const animals = [
            { name: "Lion", image: "../resources/images/lion_sound.png", soundText: "Roar!" },
            { name: "Cow", image: "../resources/images/cow_sound.png", soundText: "Mooo!" },
            { name: "Dog", image: "../resources/images/puppy_sound.png", soundText: "Woof!" },
            { name: "Cat", image: "../resources/images/cat_sound.png", soundText: "Meow!" },
            { name: "Duck", image: "../resources/images/duck_sound.png", soundText: "Quack!" },
            { name: "Sheep", image: "../resources/images/sheep_sound.png", soundText: "Baa!" },
            { name: "Elephant", image: "../resources/images/ele.png", soundText: "Trumpet!" },
            { name: "Pig", image: "../resources/images/pig_sound.png", soundText: "Oink!" },
        ];

        let currentQuizAnimal = null;
        let quizScore = 0;
        let totalQuizRounds = 0;

        /**
         * Initializes and sets up the main "Animal Sounds" application interface.
         */
        function initAnimalSoundsApp() {
            messageBoxTitle.textContent = "Animal Sounds Fun!";
            gameContentArea.innerHTML = `
                <div class="flex justify-center mb-6 space-x-4">
                    <button id="learnAnimalsBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors duration-200">Learn Animals</button>
                    <button id="guessSoundGameBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors duration-200">Guess the Sound Game</button>
                </div>
                <div id="animalAppContent" class="w-full text-center">
                    <!-- Content will be loaded here -->
                </div>
            `;

            document.getElementById('learnAnimalsBtn').addEventListener('click', displayLearnAnimals);
            document.getElementById('guessSoundGameBtn').addEventListener('click', displayGuessSoundGame);

            // Default to showing learn animals section
            displayLearnAnimals();
        }

        /**
         * Displays the "Learn Animals" section.
         * Users can click on animals to "play" their sound.
         */
        function displayLearnAnimals() {
            const appContentDiv = document.getElementById('animalAppContent');
            let animalGridHtml = '<h4 class="text-xl font-bold text-gray-800 mb-4">Click an animal to hear its sound!</h4>';
            animalGridHtml += '<div class="animal-grid">';
            animals.forEach(animal => {
                animalGridHtml += `
                    <div class="animal-tile-small" data-animal-name="${animal.name}" data-animal-sound="${animal.soundText}">
                        <img src="${animal.image}" alt="${animal.name}">
                        <span>${animal.name}</span>
                    </div>
                `;
            });
            animalGridHtml += '</div>';
            appContentDiv.innerHTML = animalGridHtml;

            // Add click listeners to animal tiles
            document.querySelectorAll('.animal-tile-small').forEach(tile => {
                tile.addEventListener('click', (event) => {
                    const animalName = event.currentTarget.dataset.animalName;
                    const animalSound = event.currentTarget.dataset.animalSound;
                    // Simulate sound playing
                    const soundFeedback = document.createElement('p');
                    soundFeedback.className = 'game-message mt-2 text-purple-700';
                    soundFeedback.textContent = `"${animalName}" says "${animalSound}"!`;
                    appContentDiv.appendChild(soundFeedback); // Temporarily add feedback

                    // Remove feedback after a short delay
                    setTimeout(() => {
                        appContentDiv.removeChild(soundFeedback);
                    }, 2000);
                });
            });
        }

        /**
         * Displays the "Guess the Sound Game" section.
         * A simulated sound is presented, and the user chooses the correct animal.
         */
        function displayGuessSoundGame() {
            const appContentDiv = document.getElementById('animalAppContent');
            appContentDiv.innerHTML = `
                <h4 class="text-xl font-bold text-gray-800 mb-4">Guess which animal makes this sound!</h4>
                <p id="quizSoundPrompt" class="game-message text-3xl font-extrabold text-indigo-700 mb-6">-</p>
                <div id="quizOptions" class="animal-game-options">
                    <!-- Options will be loaded here -->
                </div>
                <p id="quizFeedback" class="game-message mt-4"></p>
                <div class="mt-6 flex justify-center space-x-4">
                    <button id="playQuizSound" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-xl shadow-md transition-colors duration-200">Play Sound</button>
                    <button id="nextQuizRound" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-xl shadow-md transition-colors duration-200 hidden">Next Round</button>
                </div>
                <p class="game-message mt-4 text-lg">Score: <span id="quizScore">0</span> / <span id="totalQuizRounds">0</span></p>
            `;

            const quizSoundPrompt = document.getElementById('quizSoundPrompt');
            const quizOptionsDiv = document.getElementById('quizOptions');
            const quizFeedback = document.getElementById('quizFeedback');
            const playQuizSoundBtn = document.getElementById('playQuizSound');
            const nextQuizRoundBtn = document.getElementById('nextQuizRound');
            const quizScoreSpan = document.getElementById('quizScore');
            const totalQuizRoundsSpan = document.getElementById('totalQuizRounds');

            quizScore = 0; // Reset score for new game session
            totalQuizRounds = 0;
            updateScoreDisplay();

            playQuizSoundBtn.addEventListener('click', startQuizRound);
            nextQuizRoundBtn.addEventListener('click', startQuizRound);

            function updateScoreDisplay() {
                quizScoreSpan.textContent = quizScore;
                totalQuizRoundsSpan.textContent = totalQuizRounds;
            }

            /**
             * Starts a new round of the "Guess the Sound" game.
             */
            function startQuizRound() {
                quizFeedback.textContent = '';
                nextQuizRoundBtn.classList.add('hidden');
                playQuizSoundBtn.classList.remove('hidden');

                // Select a random animal for the quiz
                const correctAnimal = animals[Math.floor(Math.random() * animals.length)];
                currentQuizAnimal = correctAnimal;
                totalQuizRounds++;
                updateScoreDisplay();

                // Get 3 random distinct incorrect options
                const incorrectAnimals = animals.filter(animal => animal.name !== correctAnimal.name);
                const shuffledIncorrect = incorrectAnimals.sort(() => 0.5 - Math.random());
                const selectedIncorrect = shuffledIncorrect.slice(0, 2); // Get 2 incorrect options

                // Combine correct and incorrect options and shuffle them
                const options = [...selectedIncorrect, correctAnimal].sort(() => 0.5 - Math.random());

                quizSoundPrompt.textContent = 'Click "Play Sound" to hear!'; // Reset prompt initially
                quizOptionsDiv.innerHTML = ''; // Clear previous options

                options.forEach(animal => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'animal-game-option';
                    optionDiv.dataset.animalName = animal.name; // Corrected to camelCase
                    optionDiv.innerHTML = `<img src="${animal.image}" alt="${animal.name}" class="w-16 h-16 rounded-lg mb-2 border border-gray-400"><span>${animal.name}</span>`;
                    optionDiv.addEventListener('click', handleQuizGuess);
                    quizOptionsDiv.appendChild(optionDiv);
                });
            }

            /**
             * Handles the user's guess in the "Guess the Sound" game.
             * @param {Event} event - The click event.
             */
            function handleQuizGuess(event) {
                if (!currentQuizAnimal) return; // No active quiz round

                const guessedAnimalName = event.currentTarget.dataset.animalName;
                const allOptions = quizOptionsDiv.querySelectorAll('.animal-game-option');

                // Disable all options after a guess
                allOptions.forEach(option => {
                    option.style.pointerEvents = 'none'; // Disable clicks
                    if (option.dataset.animalName === currentQuizAnimal.name) {
                        option.classList.add('correct'); // Highlight correct answer
                    } else if (option.dataset.animalName === guessedAnimalName) {
                        option.classList.add('incorrect'); // Highlight incorrect guess
                    }
                });

                if (guessedAnimalName === currentQuizAnimal.name) {
                    quizFeedback.textContent = `ðŸ¥³ Correct! That's a "${currentQuizAnimal.name}"!`;
                    quizFeedback.style.color = '#16a34a';
                    quizScore++;
                } else {
                    quizFeedback.textContent = `ðŸ˜” Not quite! That was a "${currentQuizAnimal.soundText}" from a "${currentQuizAnimal.name}".`;
                    quizFeedback.style.color = '#dc2626';
                }
                updateScoreDisplay();

                playQuizSoundBtn.classList.add('hidden'); // Hide play sound button
                nextQuizRoundBtn.classList.remove('hidden'); // Show next round button
            }

            // Start the first round
            startQuizRound();

            // When "Play Sound" is clicked, reveal the sound text
            playQuizSoundBtn.addEventListener('click', () => {
                if (currentQuizAnimal) {
                    quizSoundPrompt.textContent = `"${currentQuizAnimal.soundText}"!`;
                }
            });
        }

        /* --- Coloring Fun Implementation --- */

        /**
         * Data for coloring pages. Each includes a title, an image URL (for reference),
         * and grid dimensions for the pixel art canvas.
         */
        const coloringPages = [
            { id: "rainbow-unicorn", title: "Rainbow Unicorn", imageUrl: "../resources/images/paint_unicon.png", gridWidth: 20, gridHeight: 20 },
            { id: "happy-robot", title: "Happy Robot", imageUrl: "../resources/images/paint_robot.png", gridWidth: 25, gridHeight: 25 },
            { id: "space-rocket", title: "Space Rocket", imageUrl: "../resources/images/paint_rocket.png", gridWidth: 15, gridHeight: 15 },
            { id: "friendly-dinosaur", title: "Friendly Dinosaur", imageUrl: "../resources/images/paint_dino.png", gridWidth: 22, gridHeight: 22 },
            { id: "cute-cat", title: "Cute Cat", imageUrl: "../resources/images/cat_paint.png", gridWidth: 18, gridHeight: 18 },
            { id: "jungle-animals", title: "Jungle Animals", imageUrl: "../resources/images/paint_forest.png", gridWidth: 30, gridHeight: 20 },
        ];

        let currentSelectedColor = null; // Track the currently selected color for pixel art

        /**
         * Initializes and sets up the "Coloring Fun" application interface.
         */
        function initColoringFun() {
            messageBoxTitle.textContent = "Coloring Fun!";
            let coloringGalleryHtml = `
                <p class="text-gray-700 text-lg mb-4">Choose a picture to color:</p>
                <div class="coloring-page-grid">
            `;
            coloringPages.forEach(page => {
                coloringGalleryHtml += `
                    <div class="coloring-thumbnail" data-page-id="${page.id}">
                        <img src="${page.imageUrl}" alt="${page.title} thumbnail">
                        <span>${page.title}</span>
                    </div>
                `;
            });
            coloringGalleryHtml += `</div>`;
            gameContentArea.innerHTML = coloringGalleryHtml;

            document.querySelectorAll('.coloring-thumbnail').forEach(thumbnail => {
                thumbnail.addEventListener('click', (event) => {
                    const pageId = event.currentTarget.dataset.pageId;
                    displayColoringPage(pageId);
                });
            });
        }

        /**
         * Displays the selected coloring page with a reference image and an interactive pixel grid.
         * @param {string} pageId - The ID of the coloring page to display.
         */
        function displayColoringPage(pageId) {
            const selectedPage = coloringPages.find(page => page.id === pageId);
            if (!selectedPage) {
                gameContentArea.innerHTML = `<p class="text-red-500">Coloring page not found!</p>`;
                return;
            }

            messageBoxTitle.textContent = `Coloring: ${selectedPage.title}`;
            gameContentArea.innerHTML = `
                <div class="coloring-canvas-main-area">
                    <div class="coloring-reference-section">
                        <h4 class="text-xl font-bold text-gray-800 mb-4">Reference Image</h4>
                        <img src="${selectedPage.imageUrl}" alt="${selectedPage.title}" class="coloring-image-display">
                    </div>

                    <div class="coloring-interactive-section">
                        <h4 class="text-xl font-bold text-gray-800 mb-4">Your Coloring Canvas</h4>
                        <div id="colorPalette" class="color-palette">
                            <!-- Color swatches will be dynamically added here -->
                        </div>
                        <div id="pixelArtCanvas" class="pixel-art-grid-container">
                            <!-- Pixel boxes will be generated here -->
                        </div>
                        <div class="mt-6 flex justify-center space-x-4">
                            <button id="clearCanvasButton" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-xl shadow-md transition-colors duration-200">Clear Canvas</button>
                            <button id="backToColoringGallery" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-xl shadow-md transition-colors duration-200">Back to Gallery</button>
                        </div>
                    </div>
                </div>
            `;

            const colorPaletteDiv = document.getElementById('colorPalette');
            const pixelArtCanvas = document.getElementById('pixelArtCanvas');
            const clearCanvasButton = document.getElementById('clearCanvasButton');

            const colors = [
                '#FF0000', '#FF7F00', '#FFFF00', '#00FF00', '#0000FF', '#4B0082', '#9400D3', // Rainbow colors
                '#FFC0CB', '#808080', '#A52A2A', '#000000', '#FFFFFF' // Pink, Gray, Brown, Black, White
            ];

            // Calculate pixel size dynamically for a responsive grid
            // Aim for roughly 20px per pixel, or adjust based on container max-width.
            const gridContainerMaxWidth = 400; /* As defined in CSS for .pixel-art-grid-container */
            const pixelSize = Math.floor(gridContainerMaxWidth / selectedPage.gridWidth);

            pixelArtCanvas.style.gridTemplateColumns = `repeat(${selectedPage.gridWidth}, 1fr)`;
            pixelArtCanvas.style.gridTemplateRows = `repeat(${selectedPage.gridHeight}, 1fr)`;
            pixelArtCanvas.style.setProperty('--pixel-size', `${pixelSize}px`); // Set CSS variable

            // Generate pixel boxes
            for (let i = 0; i < selectedPage.gridWidth * selectedPage.gridHeight; i++) {
                const pixelBox = document.createElement('div');
                pixelBox.className = 'pixel-box';
                pixelBox.addEventListener('click', () => {
                    if (currentSelectedColor) {
                        pixelBox.style.backgroundColor = currentSelectedColor;
                    }
                });
                pixelArtCanvas.appendChild(pixelBox);
            }

            // Populate color palette
            colors.forEach(color => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.backgroundColor = color;
                swatch.dataset.color = color;
                swatch.addEventListener('click', () => {
                    // Remove 'selected' class from previous swatch
                    if (currentSelectedColor) {
                        const prevSwatch = colorPaletteDiv.querySelector(`.color-swatch[data-color="${currentSelectedColor}"]`);
                        if (prevSwatch) prevSwatch.classList.remove('selected');
                    }
                    // Add 'selected' class to current swatch
                    swatch.classList.add('selected');
                    currentSelectedColor = color;
                    console.log(`Selected color: ${currentSelectedColor}`);
                });
                colorPaletteDiv.appendChild(swatch);
            });

            // Automatically select the first color
            if (colors.length > 0) {
                const firstSwatch = colorPaletteDiv.querySelector(`.color-swatch[data-color="${colors[0]}"]`);
                if (firstSwatch) {
                    firstSwatch.classList.add('selected');
                    currentSelectedColor = colors[0];
                }
            }


            // Clear Canvas button functionality
            clearCanvasButton.addEventListener('click', () => {
                document.querySelectorAll('.pixel-box').forEach(box => {
                    box.style.backgroundColor = '#ffffff'; // Reset to white
                });
            });

            document.getElementById('backToColoringGallery').addEventListener('click', initColoringFun);
        }

        /* --- Music Maker Implementation --- */

        let synth = null; // Declare synth globally or within the function scope to be accessible for stopping

        /**
         * Initializes and sets up the "Music Maker" application interface.
         */
        function initMusicMakerApp() {
            messageBoxTitle.textContent = "Music Maker Fun!";
            gameContentArea.innerHTML = `
                <p class="text-gray-700 text-lg mb-4">Play notes or hear some fun melodies!</p>

                <div id="currentPlayingNoteDisplay" class="current-note-display"></div>

                <div class="piano-keyboard">
                    <button class="piano-key" data-note="C4">C</button>
                    <button class="piano-key" data-note="D4">D</button>
                    <button class="piano-key" data-note="E4">E</button>
                    <button class="piano-key" data-note="F4">F</button>
                    <button class="piano-key" data-note="G4">G</button>
                    <button class="piano-key" data-note="A4">A</button>
                    <button class="piano-key" data-note="B4">B</button>
                    <button class="piano-key" data-note="C5">C5</button>
                </div>

                <p class="text-gray-700 text-lg mb-4">Try some pre-made melodies:</p>
                <div class="melody-buttons">
                    <button class="melody-button" data-melody="twinkle">Twinkle, Twinkle</button>
                    <button class="melody-button" data-melody="mary">Mary Had a Little Lamb</button>
                    <button class="melody-button" data-melody="scales">Ascending Scale</button>
                </div>

                <div class="music-controls">
                    <button id="stopMusicButton" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-6 rounded-xl shadow-md transition-colors duration-200">Stop All Music</button>
                </div>
            `;

            // Initialize Tone.js Synth if not already initialized
            if (!synth) {
                synth = new Tone.Synth().toDestination();
                // Start Tone.js context on first user interaction for web audio API
                document.documentElement.addEventListener('mousedown', () => {
                    if (Tone.context.state !== 'running') {
                        Tone.context.resume();
                    }
                }, { once: true });
            }

            const currentPlayingNoteDisplay = document.getElementById('currentPlayingNoteDisplay');
            const pianoKeys = document.querySelectorAll('.piano-key');

            // Add event listeners for piano keys
            pianoKeys.forEach(key => {
                key.addEventListener('click', (event) => {
                    const note = event.target.dataset.note;
                    if (synth) {
                        synth.triggerAttackRelease(note, "8n"); // Play note for an eighth note
                        // Optional: Temporarily highlight key on manual press
                        key.classList.add('active-key');
                        setTimeout(() => {
                            key.classList.remove('active-key');
                        }, Tone.Time("8n").toMilliseconds());
                    }
                    currentPlayingNoteDisplay.textContent = note; // Display the note
                });
            });

            // Define melodies
            const melodies = {
                twinkle: [
                    { note: "C4", duration: "4n" }, { note: "C4", duration: "4n" }, { note: "G4", duration: "4n" }, { note: "G4", duration: "4n" },
                    { note: "A4", duration: "4n" }, { note: "A4", duration: "4n" }, { note: "G4", duration: "2n" },
                    { note: "F4", duration: "4n" }, { note: "F4", duration: "4n" }, { note: "E4", duration: "4n" }, { note: "E4", duration: "4n" },
                    { note: "D4", duration: "4n" }, { note: "D4", duration: "4n" }, { note: "C4", duration: "2n" }
                ],
                mary: [
                    { note: "E4", duration: "4n" }, { note: "D4", duration: "4n" }, { note: "C4", duration: "4n" }, { note: "D4", duration: "4n" },
                    { note: "E4", duration: "4n" }, { note: "E4", duration: "4n" }, { note: "E4", duration: "2n" },
                    { note: "D4", duration: "4n" }, { note: "D4", duration: "4n" }, { note: "D4", duration: "2n" },
                    { note: "E4", duration: "4n" }, { note: "G4", duration: "4n" }, { note: "G4", duration: "2n" }
                ],
                scales: [
                    { note: "C4", duration: "8n" }, { note: "D4", duration: "8n" }, { note: "E4", duration: "8n" }, { note: "F4", duration: "8n" },
                    { note: "G4", duration: "8n" }, { note: "A4", duration: "8n" }, { note: "B4", duration: "8n" }, { note: "C5", duration: "8n" }
                ]
            };

            let currentSequence = null; // To hold the Tone.Sequence instance

            /**
             * Plays a sequence of notes for a given melody, highlighting keys and displaying notes.
             * @param {Array<Object>} melody - An array of note objects ({note: string, duration: string}).
             */
            function playMelody(melody) {
                // Stop any currently playing sequence
                if (currentSequence) {
                    Tone.Transport.stop();
                    Tone.Transport.cancel();
                    currentSequence.dispose(); // Clean up previous sequence
                    currentSequence = null; // Reset sequence
                }
                // Clear any active key highlights
                pianoKeys.forEach(key => key.classList.remove('active-key'));
                currentPlayingNoteDisplay.textContent = ''; // Clear displayed note

                // Create a new sequence
                currentSequence = new Tone.Sequence((time, noteInfo) => {
                    // Schedule note playback
                    if (synth) {
                        synth.triggerAttackRelease(noteInfo.note, noteInfo.duration, time);
                    }

                    // Schedule visual updates
                    Tone.Draw.schedule(() => {
                        // Clear previous note display and highlight
                        currentPlayingNoteDisplay.textContent = noteInfo.note;
                        pianoKeys.forEach(key => key.classList.remove('active-key'));

                        // Highlight current key
                        const activeKey = document.querySelector(`.piano-key[data-note="${noteInfo.note}"]`);
                        if (activeKey) {
                            activeKey.classList.add('active-key');
                        }

                        // Schedule removal of highlight after note duration
                        setTimeout(() => {
                            if (activeKey) {
                                activeKey.classList.remove('active-key');
                            }
                        }, Tone.Time(noteInfo.duration).toMilliseconds());

                    }, time); // Schedule drawing at the same time as the note
                }, melody, "4n"); // "4n" means each step in the sequence is a quarter note apart

                // Start the transport and the sequence
                Tone.Transport.start();
                currentSequence.start(0); // Start from the beginning
            }

            // Add event listeners for melody buttons
            document.querySelectorAll('.melody-button').forEach(button => {
                button.addEventListener('click', (event) => {
                    const melodyId = event.target.dataset.melody;
                    if (melodies[melodyId]) {
                        playMelody(melodies[melodyId]);
                    }
                });
            });

            // Stop all music button
            document.getElementById('stopMusicButton').addEventListener('click', () => {
                if (currentSequence) {
                    Tone.Transport.stop();
                    Tone.Transport.cancel();
                    currentSequence.dispose(); // Clean up the sequence
                    currentSequence = null;
                }
                pianoKeys.forEach(key => key.classList.remove('active-key')); // Clear all highlights
                currentPlayingNoteDisplay.textContent = ''; // Clear displayed note
            });
        }

        /* --- Shape Sorter Implementation --- */

        const shapesData = [
            { id: 'shape1', type: 'circle', color: '#EF4444', emoji: 'ðŸ”´' }, // Red
            { id: 'shape2', type: 'circle', color: '#F97316', emoji: 'ðŸŸ ' }, // Orange
            { id: 'shape3', type: 'square', color: '#22C55E', emoji: 'ðŸŸ©' }, // Green
            { id: 'shape4', type: 'square', color: '#10B981', emoji: 'ðŸŸ¢' }, // Emerald
            { id: 'shape5', type: 'triangle', color: '#3B82F6', emoji: 'ðŸ”º' }, // Blue
            { id: 'shape6', type: 'triangle', color: '#6366F1', emoji: 'ðŸ”¼' }, // Indigo
            { id: 'shape7', type: 'star', color: '#EAB308', emoji: 'â­' }, // Yellow
            { id: 'shape8', type: 'star', color: '#FDE047', emoji: 'ðŸŒŸ' }, // Light Yellow
            { id: 'shape9', type: 'rectangle', color: '#EC4899', emoji: 'ðŸŸª' }, // Pink
            { id: 'shape10', type: 'rectangle', color: '#D946EF', emoji: 'ðŸŸ«' }, // Purple
        ];

        let currentShapes = [];
        let score = 0;
        let totalShapesCount = 0;
        let draggedElement = null; // To store the currently dragged shape element

        /**
         * Shuffles an array in place.
         * @param {Array} array - The array to shuffle.
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /**
         * Renders the draggable shapes into the drag area.
         */
        function renderShapes() {
            const shapeDragArea = document.getElementById('shapeDragArea');
            shapeDragArea.innerHTML = ''; // Clear existing shapes
            currentShapes.forEach(shape => {
                const shapeDiv = document.createElement('div');
                shapeDiv.className = 'draggable-shape';
                shapeDiv.draggable = true;
                shapeDiv.dataset.shapeId = shape.id;
                shapeDiv.dataset.shapeType = shape.type;
                shapeDiv.style.backgroundColor = shape.color; // Set background color
                shapeDiv.innerHTML = shape.emoji; // Use emoji for visual representation

                shapeDiv.addEventListener('dragstart', handleDragStart);
                shapeDiv.addEventListener('dragend', handleDragEnd); // Clean up after drag
                shapeDragArea.appendChild(shapeDiv);
            });
        }

        /**
         * Renders the drop bins for each shape type.
         */
        function renderBins() {
            const shapeDropArea = document.getElementById('shapeDropArea');
            shapeDropArea.innerHTML = ''; // Clear existing bins

            // Get unique shape types from shapesData
            const uniqueShapeTypes = [...new Set(shapesData.map(shape => shape.type))];

            uniqueShapeTypes.forEach(type => {
                const binDiv = document.createElement('div');
                binDiv.className = 'drop-bin';
                binDiv.dataset.binType = type;
                binDiv.innerHTML = `
                    ${getShapeSVG(type)}
                    <span>${type.charAt(0).toUpperCase() + type.slice(1)} Bin</span>
                `;

                binDiv.addEventListener('dragover', handleDragOver);
                binDiv.addEventListener('dragleave', handleDragLeave);
                binDiv.addEventListener('drop', handleDrop);
                shapeDropArea.appendChild(binDiv);
            });
        }

        /**
         * Returns SVG string for a given shape type.
         * @param {string} type - The type of shape (e.g., 'circle', 'square').
         * @returns {string} - The SVG string.
         */
        function getShapeSVG(type) {
            switch (type) {
                case 'circle':
                    return `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="currentColor"/></svg>`;
                case 'square':
                    return `<svg viewBox="0 0 100 100"><rect x="10" y="10" width="80" height="80" fill="currentColor"/></svg>`;
                case 'triangle':
                    return `<svg viewBox="0 0 100 100"><polygon points="50,10 90,90 10,90" fill="currentColor"/></svg>`;
                case 'star':
                    // A simple 5-point star SVG
                    return `<svg viewBox="0 0 100 100"><polygon points="50,5 61,39 98,39 68,61 79,95 50,73 21,95 32,61 2,39 39,39" fill="currentColor"/></svg>`;
                case 'rectangle':
                    return `<svg viewBox="0 0 100 100"><rect x="10" y="25" width="80" height="50" fill="currentColor"/></svg>`;
                default:
                    return '';
            }
        }

        /**
         * Handles the dragstart event for a draggable shape.
         * @param {DragEvent} event
         */
        function handleDragStart(event) {
            draggedElement = event.target;
            event.dataTransfer.setData('text/plain', draggedElement.dataset.shapeType);
            draggedElement.classList.add('dragging');
        }

        /**
         * Handles the dragend event for a draggable shape.
         * @param {DragEvent} event
         */
        function handleDragEnd(event) {
            if (event.target) { // Defensive check
                event.target.classList.remove('dragging');
            }
            draggedElement = null; // Clear the dragged element reference
        }

        /**
         * Handles the dragover event for a drop bin.
         * @param {DragEvent} event
         */
        function handleDragOver(event) {
            event.preventDefault(); // Necessary to allow dropping
            if (event.currentTarget) { // Defensive check
                event.currentTarget.classList.add('drag-over');
            }
        }

        /**
         * Handles the dragleave event for a drop bin.
         * @param {DragEvent} event
         */
        function handleDragLeave(event) {
            if (event.currentTarget) { // Defensive check
                event.currentTarget.classList.remove('drag-over');
            }
        }

        /**
         * Handles the drop event for a drop bin.
         * @param {DragEvent} event
         */
        function handleDrop(event) {
            event.preventDefault();
            const droppedShapeType = event.dataTransfer.getData('text/plain');
            const targetBin = event.currentTarget;
            const feedbackDisplay = document.getElementById('gameFeedback');
            const scoreDisplay = document.getElementById('scoreDisplay');

            if (!targetBin) { // Ensure targetBin is not null
                console.error("Drop target bin is null.");
                return;
            }

            targetBin.classList.remove('drag-over'); // Remove drag-over class

            if (droppedShapeType === targetBin.dataset.binType) {
                score++;
                if (feedbackDisplay) { // Defensive check
                    feedbackDisplay.textContent = `ðŸ¥³ Great job! That's a ${droppedShapeType}!`;
                    feedbackDisplay.style.color = '#16a34a'; // Green
                }
                targetBin.classList.add('correct-drop');
                // Remove the shape from the draggable area
                if (draggedElement) {
                    draggedElement.remove();
                    // Remove from currentShapes array
                    currentShapes = currentShapes.filter(shape => shape.id !== draggedElement.dataset.shapeId);
                }
            } else {
                if (feedbackDisplay) { // Defensive check
                    feedbackDisplay.textContent = `ðŸ˜” Oops! That's not a ${targetBin.dataset.binType}. Try again!`;
                    feedbackDisplay.style.color = '#dc2626'; // Red
                }
                targetBin.classList.add('incorrect-drop');
            }

            if (scoreDisplay) { // Defensive check
                scoreDisplay.textContent = `Score: ${score} / ${totalShapesCount}`;
            }

            // Remove feedback and color after a short delay
            setTimeout(() => {
                if (feedbackDisplay) feedbackDisplay.textContent = ''; // Check if feedbackDisplay exists
                if (targetBin) targetBin.classList.remove('correct-drop', 'incorrect-drop'); // Check if targetBin exists
            }, 1500);

            // Check if all shapes are sorted
            if (currentShapes.length === 0) {
                if (feedbackDisplay) { // Check if feedbackDisplay exists
                    feedbackDisplay.textContent = `ðŸŽ‰ You sorted all the shapes! Well done!`;
                    feedbackDisplay.style.color = '#4f46e5';
                }
                const resetButton = document.getElementById('resetShapeSorterButton');
                if (resetButton) resetButton.classList.remove('hidden'); // Check if button exists
            }
        }

        /**
         * Initializes and sets up the "Shape Sorter" game.
         */
        function initShapeSorterGame() {
            messageBoxTitle.textContent = "Shape Sorter!";
            gameContentArea.innerHTML = `
                <div class="shape-sorter-game">
                    <p class="text-gray-700 text-lg mb-4">Drag each shape to its matching bin!</p>

                    <div id="shapeDragArea" class="shape-drag-area">
                        <!-- Draggable shapes will be rendered here -->
                    </div>

                    <div id="shapeDropArea" class="shape-drop-area">
                        <!-- Drop bins will be rendered here -->
                    </div>

                    <p id="scoreDisplay" class="score-display">Score: 0 / 0</p>
                    <p id="gameFeedback" class="game-feedback"></p>

                    <button id="resetShapeSorterButton" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-6 rounded-xl shadow-md transition-colors duration-200 mt-6">Play Again</button>
                </div>
            `;

            document.getElementById('resetShapeSorterButton').addEventListener('click', resetShapeSorterGame);

            resetShapeSorterGame(); // Start the first game round
        }

        /**
         * Resets the Shape Sorter game to a new round.
         */
        function resetShapeSorterGame() {
            score = 0;
            // Create a fresh copy of shapesData and shuffle it
            currentShapes = [...shapesData];
            shuffleArray(currentShapes);
            totalShapesCount = currentShapes.length;

            document.getElementById('scoreDisplay').textContent = `Score: ${score} / ${totalShapesCount}`;
            document.getElementById('gameFeedback').textContent = '';
            document.getElementById('resetShapeSorterButton').classList.add('hidden');

            renderShapes();
            renderBins();
        }

        /* --- Memory Match Implementation --- */

        const memoryCardEmojis = ['ðŸŽ', 'ðŸŒ', 'ðŸ‡', 'ðŸ“', 'ðŸ', 'ðŸ‰', 'ðŸ¥', 'ðŸ¥­']; // 8 unique emojis
        let memoryCards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let canFlip = true;

        /**
         * Initializes and sets up the "Memory Match" game.
         */
        function initMemoryMatchGame() {
            messageBoxTitle.textContent = "Memory Match!";
            gameContentArea.innerHTML = `
                <p class="text-gray-700 text-lg mb-4">Find all the matching pairs!</p>
                <div id="memoryGrid" class="memory-grid">
                    <!-- Memory cards will be rendered here -->
                </div>
                <p id="memoryScore" class="score-display">Pairs Found: 0 / ${memoryCardEmojis.length}</p>
                <p id="memoryFeedback" class="game-feedback"></p>
                <button id="resetMemoryGameButton" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-6 rounded-xl shadow-md transition-colors duration-200 mt-6">Play Again</button>
            `;

            document.getElementById('resetMemoryGameButton').addEventListener('click', resetMemoryGame);

            resetMemoryGame(); // Start the first game
        }

        /**
         * Resets the Memory Match game.
         */
        function resetMemoryGame() {
            flippedCards = [];
            matchedPairs = 0;
            canFlip = true;
            document.getElementById('memoryScore').textContent = `Pairs Found: 0 / ${memoryCardEmojis.length}`;
            document.getElementById('memoryFeedback').textContent = '';
            document.getElementById('resetMemoryGameButton').classList.add('hidden');

            // Create pairs and shuffle
            memoryCards = [...memoryCardEmojis, ...memoryCardEmojis];
            shuffleArray(memoryCards); // Using the existing shuffleArray function

            renderMemoryGrid();
        }

        /**
         * Renders the memory game grid.
         */
        function renderMemoryGrid() {
            const memoryGrid = document.getElementById('memoryGrid');
            memoryGrid.innerHTML = ''; // Clear existing cards

            memoryCards.forEach((emoji, index) => {
                const card = document.createElement('div');
                card.classList.add('memory-card');
                card.dataset.emoji = emoji;
                card.dataset.index = index; // Use index to identify unique cards

                card.innerHTML = `
                    <div class="memory-card-inner memory-card-back">?</div>
                    <div class="memory-card-inner memory-card-front">
                        ${emoji}
                        <span class="memory-card-matched-indicator">âœ…</span>
                    </div>
                `;

                card.addEventListener('click', handleCardClick);
                memoryGrid.appendChild(card);
            });
        }

        /**
         * Handles a click on a memory card.
         * @param {Event} event
         */
        function handleCardClick(event) {
            const clickedCard = event.currentTarget;

            // Do nothing if not allowed to flip, card is already flipped, or already matched
            if (!canFlip || clickedCard.classList.contains('flipped') || clickedCard.classList.contains('matched')) {
                return;
            }

            clickedCard.classList.add('flipped');
            flippedCards.push(clickedCard);

            if (flippedCards.length === 2) {
                canFlip = false; // Prevent further flips
                const [card1, card2] = flippedCards;

                if (card1.dataset.emoji === card2.dataset.emoji) {
                    // Match found!
                    matchedPairs++;
                    document.getElementById('memoryScore').textContent = `Pairs Found: ${matchedPairs} / ${memoryCardEmojis.length}`;
                    document.getElementById('memoryFeedback').textContent = `ðŸŽ‰ Match! You found a pair of ${card1.dataset.emoji}!`;
                    document.getElementById('memoryFeedback').style.color = '#16a34a';

                    card1.classList.add('matched');
                    card2.classList.add('matched');

                    flippedCards = []; // Reset flipped cards
                    canFlip = true; // Allow flipping again

                    if (matchedPairs === memoryCardEmojis.length) {
                        document.getElementById('memoryFeedback').textContent = `ðŸ† Congratulations! You found all the pairs!`;
                        document.getElementById('memoryFeedback').style.color = '#4f46e5';
                        document.getElementById('resetMemoryGameButton').classList.remove('hidden');
                    }

                } else {
                    // No match, flip back after a delay
                    document.getElementById('memoryFeedback').textContent = `ðŸ˜” No match. Try again!`;
                    document.getElementById('memoryFeedback').style.color = '#dc2626';

                    setTimeout(() => {
                        card1.classList.remove('flipped');
                        card2.classList.remove('flipped');
                        flippedCards = [];
                        canFlip = true; // Allow flipping again
                        document.getElementById('memoryFeedback').textContent = ''; // Clear feedback
                    }, 1000); // Flip back after 1 second
                }
            }
        }

        /* --- Number Explorer Implementation --- */

        let currentNumberToCount = 0;
        let currentProblemType = 'count'; // 'count', 'addition', 'subtraction'
        let currentAnswer = 0;

        /**
         * Returns SVG string for a banana.
         * @returns {string} - The SVG string.
         */
        function getBananaSVG() {
            // A simple banana shape SVG
            return `<svg class="number-item-banana-svg" viewBox="0 0 100 100">
                        <path d="M20,90 C10,70 10,30 50,10 C90,30 90,70 80,90 C70,95 30,95 20,90 Z" />
                    </svg>`;
        }

        /**
         * Returns SVG string for an operator (+, -, =).
         * @param {string} operator - The operator symbol.
         * @returns {string} - The SVG string.
         */
        function getOperatorSVG(operator) {
            let path = '';
            if (operator === '+') {
                path = `M10,50 H90 M50,10 V90`; // Plus sign
            } else if (operator === '-') {
                path = `M10,50 H90`; // Minus sign
            } else if (operator === '=') {
                path = `M10,40 H90 M10,60 H90`; // Equals sign
            }
            return `<svg class="operator-svg" viewBox="0 0 100 100" stroke="currentColor" stroke-width="10" fill="none">
                        <path d="${path}" />
                    </svg>`;
        }

        /**
         * Initializes and sets up the "Number Explorer" game.
         */
        function initNumberExplorerGame() {
            messageBoxTitle.textContent = "Number Explorer!";
            gameContentArea.innerHTML = `
                <div class="number-explorer-game">
                    <p class="text-gray-700 text-lg mb-4">Choose a number game!</p>
                    <div class="number-game-options">
                        <button id="countItemsBtn" class="number-game-option-btn">Count Items</button>
                        <button id="additionGameBtn" class="number-game-option-btn">Addition Game</button>
                        <button id="subtractionGameBtn" class="number-game-option-btn">Subtraction Game</button>
                    </div>

                    <div id="numberGameContent" class="w-full text-center">
                        <!-- Game content will be loaded here -->
                    </div>
                </div>
            `;

            document.getElementById('countItemsBtn').addEventListener('click', () => {
                currentProblemType = 'count';
                displayCountingGame();
            });
            document.getElementById('additionGameBtn').addEventListener('click', () => {
                currentProblemType = 'addition';
                displayAdditionGame();
            });
            document.getElementById('subtractionGameBtn').addEventListener('click', () => {
                currentProblemType = 'subtraction';
                displaySubtractionGame();
            });

            // Start with the counting game by default
            displayCountingGame();
        }

        /**
         * Displays the counting game interface and generates a new counting problem.
         */
        function displayCountingGame() {
            const numberGameContent = document.getElementById('numberGameContent');
            numberGameContent.innerHTML = `
                <p class="text-gray-700 text-lg mb-4">Count the items and type the number!</p>
                <div id="numberDisplayArea" class="number-display-area">
                    <!-- Items to count will be rendered here -->
                </div>
                <div class="number-input-section">
                    <input type="number" id="numberGuessInput" class="game-input" placeholder="How many items?">
                    <button id="checkNumberButton" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-xl shadow-md transition-colors duration-200">Check</button>
                    <p id="numberFeedback" class="game-message mt-4"></p>
                    <button id="nextNumberButton" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-6 rounded-xl shadow-md transition-colors duration-200 mt-4 hidden">Next Number</button>
                </div>
            `;
            // Re-attach event listeners for the newly rendered elements
            document.getElementById('checkNumberButton').addEventListener('click', checkNumberGuess);
            document.getElementById('numberGuessInput').addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    checkNumberGuess();
                }
            });
            document.getElementById('nextNumberButton').addEventListener('click', generateNewNumber);

            generateNewNumber(); // Generate a new counting problem
        }

        /**
         * Displays the addition game interface and generates a new addition problem.
         */
        function displayAdditionGame() {
            const numberGameContent = document.getElementById('numberGameContent');
            numberGameContent.innerHTML = `
                <p class="text-gray-700 text-lg mb-4">Solve the addition problem!</p>
                <div id="numberProblemDisplay" class="number-problem-display"></div>
                <div id="numberDisplayArea" class="number-display-area"></div> <!-- ADDED for visuals -->
                <div class="number-input-section">
                    <input type="number" id="numberGuessInput" class="game-input" placeholder="Your answer">
                    <button id="checkNumberButton" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-xl shadow-md transition-colors duration-200">Check</button>
                    <p id="numberFeedback" class="game-message mt-4"></p>
                    <button id="nextNumberButton" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-6 rounded-xl shadow-md transition-colors duration-200 mt-4 hidden">Next Problem</button>
                </div>
            `;
            // Re-attach event listeners
            document.getElementById('checkNumberButton').addEventListener('click', checkNumberGuess);
            document.getElementById('numberGuessInput').addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    checkNumberGuess();
                }
            });
            document.getElementById('nextNumberButton').addEventListener('click', generateNewNumber);

            generateNewNumber(); // Generate a new addition problem
        }

        /**
         * Displays the subtraction game interface and generates a new subtraction problem.
         */
        function displaySubtractionGame() {
            const numberGameContent = document.getElementById('numberGameContent');
            numberGameContent.innerHTML = `
                <p class="text-gray-700 text-lg mb-4">Solve the subtraction problem!</p>
                <div id="numberProblemDisplay" class="number-problem-display"></div>
                <div id="numberDisplayArea" class="number-display-area"></div> <!-- ADDED for visuals -->
                <div class="number-input-section">
                    <input type="number" id="numberGuessInput" class="game-input" placeholder="Your answer">
                    <button id="checkNumberButton" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-xl shadow-md transition-colors duration-200">Check</button>
                    <p id="numberFeedback" class="game-message mt-4"></p>
                    <button id="nextNumberButton" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-6 rounded-xl shadow-md transition-colors duration-200 mt-4 hidden">Next Problem</button>
                </div>
            `;
            // Re-attach event listeners
            document.getElementById('checkNumberButton').addEventListener('click', checkNumberGuess);
            document.getElementById('numberGuessInput').addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    checkNumberGuess();
                }
            });
            document.getElementById('nextNumberButton').addEventListener('click', generateNewNumber);

            generateNewNumber(); // Generate a new subtraction problem
        }

        /**
         * Generates a new problem based on the currentProblemType.
         */
        function generateNewNumber() {
            const numberDisplayArea = document.getElementById('numberDisplayArea'); // Visual items
            const numberProblemDisplay = document.getElementById('numberProblemDisplay'); // Text problem
            const numberGuessInput = document.getElementById('numberGuessInput');
            const numberFeedback = document.getElementById('numberFeedback');
            const checkNumberButton = document.getElementById('checkNumberButton');
            const nextNumberButton = document.getElementById('nextNumberButton');

            // Clear content of specific display areas
            if (numberDisplayArea) numberDisplayArea.innerHTML = '';
            if (numberProblemDisplay) numberProblemDisplay.textContent = '';

            numberGuessInput.value = '';
            numberFeedback.textContent = '';
            numberGuessInput.disabled = false;
            checkNumberButton.disabled = false;
            nextNumberButton.classList.add('hidden');

            let num1, num2;

            switch (currentProblemType) {
                case 'count':
                    currentNumberToCount = Math.floor(Math.random() * 10) + 1;
                    currentAnswer = currentNumberToCount;
                    for (let i = 0; i < currentNumberToCount; i++) {
                        if (numberDisplayArea) numberDisplayArea.innerHTML += getBananaSVG();
                    }
                    break;
                case 'addition':
                    num1 = Math.floor(Math.random() * 5) + 1; // Keep numbers small for visual clarity
                    num2 = Math.floor(Math.random() * 5) + 1; // Keep numbers small for visual clarity
                    currentAnswer = num1 + num2;
                    if (numberProblemDisplay) numberProblemDisplay.textContent = `${num1} + ${num2} = ?`;
                    if (numberDisplayArea) {
                        for (let i = 0; i < num1; i++) numberDisplayArea.innerHTML += getBananaSVG();
                        numberDisplayArea.innerHTML += getOperatorSVG('+');
                        for (let i = 0; i < num2; i++) numberDisplayArea.innerHTML += getBananaSVG();
                        numberDisplayArea.innerHTML += getOperatorSVG('=');
                        numberDisplayArea.innerHTML += `<span class="number-problem-display text-gray-700">?</span>`; // Placeholder for answer
                    }
                    break;
                case 'subtraction':
                    num1 = Math.floor(Math.random() * 10) + 1;
                    num2 = Math.floor(Math.random() * num1) + 1; // num2 is always less than or equal to num1
                    currentAnswer = num1 - num2;
                    if (numberProblemDisplay) numberProblemDisplay.textContent = `${num1} - ${num2} = ?`;
                    if (numberDisplayArea) {
                        for (let i = 0; i < num1; i++) numberDisplayArea.innerHTML += getBananaSVG();
                        numberDisplayArea.innerHTML += getOperatorSVG('-');
                        for (let i = 0; i < num2; i++) numberDisplayArea.innerHTML += getBananaSVG();
                        numberDisplayArea.innerHTML += getOperatorSVG('=');
                        numberDisplayArea.innerHTML += `<span class="number-problem-display text-gray-700">?</span>`; // Placeholder for answer
                    }
                    break;
            }
        }

        /**
         * Checks the user's guess for the "Number Explorer" game.
         */
        function checkNumberGuess() {
            const numberGuessInput = document.getElementById('numberGuessInput');
            const numberFeedback = document.getElementById('numberFeedback');
            const checkNumberButton = document.getElementById('checkNumberButton');
            const nextNumberButton = document.getElementById('nextNumberButton');

            const userGuess = parseInt(numberGuessInput.value);

            if (isNaN(userGuess)) {
                if (numberFeedback) {
                    numberFeedback.textContent = 'Please enter a number.';
                    numberFeedback.style.color = '#dc2626';
                }
                return;
            }

            if (userGuess === currentAnswer) {
                if (numberFeedback) {
                    numberFeedback.textContent = `ðŸŽ‰ Correct! The answer is ${currentAnswer}!`;
                    numberFeedback.style.color = '#16a34a';
                }
            } else {
                if (numberFeedback) {
                    numberFeedback.textContent = `ðŸ˜” Not quite! The correct answer is ${currentAnswer}. Try again on the next round!`;
                    numberFeedback.style.color = '#dc2626';
                }
            }

            numberGuessInput.disabled = true;
            checkNumberButton.disabled = true;
            nextNumberButton.classList.remove('hidden');
        }

        /* --- NEW: Theme Selector Implementation --- */

        // Define themes with their properties
        const themes = {
            'default': { name: 'Default Fun', bodyClass: '', headerGradient: 'purple-600 to-indigo-700', previewColor: '#8b5cf6' },
            'rainbow': { name: 'Rainbow Blast', bodyClass: 'theme-rainbow', headerGradient: 'red-500, #f97316, #eab308, #22c55e, #3b82f6, #6366f1, #9333ea', previewColor: 'linear-gradient(to right, #ef4444, #f97316, #eab308, #22c55e, #3b82f6, #6366f1, #9400D3)' },
            'unicorn': { name: 'Unicorn Dream', bodyClass: 'theme-unicorn', headerGradient: 'pink-300 to-purple-400', previewColor: 'linear-gradient(to bottom right, #fbcfe8, #f0abfc, #d8b4fe)' },
            'chocolate': { name: 'Chocolate Delight', bodyClass: 'theme-chocolate', headerGradient: 'amber-800 to-yellow-800', previewColor: 'linear-gradient(to bottom right, #7c2d12, #9a3412, #b45309)' },
            'carracing': { name: 'Car Racing', bodyClass: 'theme-carracing', headerGradient: 'gray-800 to-gray-600', previewColor: 'linear-gradient(to bottom right, #1f2937, #374151, #4b5563)' },
        };

        /**
         * Initializes and sets up the "Theme Selector" interface.
         */
        function initThemeSelector() {
            messageBoxTitle.textContent = "Choose Your Theme!";
            let themeGalleryHtml = `
                <p class="text-gray-700 text-lg mb-4">Select a theme to change the look of the Fun Zone:</p>
                <div class="theme-selection-grid">
            `;
            for (const themeId in themes) {
                const theme = themes[themeId];
                themeGalleryHtml += `
                    <div class="theme-option-card" data-theme-id="${themeId}">
                        <div class="theme-preview-box" style="background: ${theme.previewColor};"></div>
                        <span>${theme.name}</span>
                    </div>
                `;
            }
            themeGalleryHtml += `</div>`;
            gameContentArea.innerHTML = themeGalleryHtml;

            document.querySelectorAll('.theme-option-card').forEach(card => {
                card.addEventListener('click', (event) => {
                    const themeId = event.currentTarget.dataset.themeId;
                    applyTheme(themeId);
                    hideMessageBox(); // Close after selection
                });
            });
        }

        /**
         * Applies the selected theme to the body, header, and footer.
         * Stores the selected theme in localStorage for persistence.
         * @param {string} themeId - The ID of the theme to apply.
         */
        function applyTheme(themeId) {
            const body = document.body;
            const header = document.querySelector('header');
            const footer = document.querySelector('footer');

            // Remove all existing theme classes from body
            for (const key in themes) {
                if (themes[key].bodyClass) {
                    body.classList.remove(themes[key].bodyClass);
                }
            }

            // Apply the selected theme class to body
            const selectedTheme = themes[themeId];
            if (selectedTheme && selectedTheme.bodyClass) {
                body.classList.add(selectedTheme.bodyClass);
            }

            // Apply header gradient
            if (header && selectedTheme && selectedTheme.headerGradient) {
                 // Reconstruct the linear-gradient string
                 header.style.backgroundImage = `linear-gradient(to right, ${selectedTheme.headerGradient})`;
            } else if (header) {
                // Default gradient if no specific one
                header.style.backgroundImage = `linear-gradient(to right, #8b5cf6, #6366f1)`;
            }

            // Store theme preference in localStorage
            localStorage.setItem('kidsFunZoneTheme', themeId);
        }

        /* --- End Game/App Implementations --- */

        // Add click event listener to each tile
        gameTiles.forEach(tile => {
            tile.addEventListener('click', () => {
                const title = tile.dataset.title;
                const description = tile.dataset.description;
                const gameId = tile.dataset.gameId; // Get the game ID if available

                showMessageBox(title, description, gameId);
            });
        });

        // Add click event listener to the close button of the message box
        closeMessageBoxButton.addEventListener('click', hideMessageBox);

        // Hide message box if clicked outside (optional)
        messageBoxContainer.addEventListener('click', (event) => {
            if (event.target === messageBoxContainer) {
                hideMessageBox();
            }
        });

        // NEW: Apply saved theme on page load
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('kidsFunZoneTheme') || 'default';
            applyTheme(savedTheme);
        });
    </script>
</body>
</html>
